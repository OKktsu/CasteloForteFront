<div class="page-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">Contentamento Financiado</h1>
            <nav class="breadcrumb">
                Módulo: Método VIPE
            </nav>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Contentamento Financiado</h2>
        </div>
        <div class="card-body">
            <p class="card-description">
                Defina o que representa "suficiente" para você financeiramente. Esta ferramenta ajuda a criar clareza sobre seus objetivos financeiros e estilo de vida que deseja manter.
            </p>

            <form class="form-content">
                <div class="form-group">
                    <label for="estilo-vida">Descreva o estilo de vida que representa "suficiente" para você:</label>
                    <textarea id="estilo-vida" rows="4" placeholder="Ex: Uma casa confortável, carro para a família, viagens anuais, educação dos filhos, aposentadoria tranquila..."></textarea>
                </div>

                <div class="form-group">
                    <label for="numero-suficiencia">Número de Suficiência (R$):</label>
                    <input type="text" id="numero-suficiencia" value="R$ 1.000.000,00">
                </div>

                <div class="form-group">
                    <label for="medos-barreiras">Quais são seus principais medos e barreiras em relação ao dinheiro?</label>
                    <textarea id="medos-barreiras" rows="4" placeholder="Ex: Medo de perder tudo, dificuldade para poupar, pressão social para gastar..."></textarea>
                </div>
            </form>
        </div>
        <div class="card-footer">
            <button class="btn btn-primary">Avaliar com a Castelo Forte</button>
            <button class="btn btn-outline btn-save"><i class="fa-solid fa-save"></i> Salvar</button>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Análises de IA</h2>
        </div>
        <div class="card-body">
            <p class="card-description">
                Visualize as análises geradas para esta ferramenta.
            </p>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>DATA</th>
                            <th>STATUS</th>
                            <th>AÇÕES</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (analise of analises; track analise.id) {
                            <tr>
                                <td>{{ analise.data }}</td>
                                <td><span class="status-badge status-concluida">{{ analise.status }}</span></td>
                                <td class="actions">
                                    <button class="btn-icon" aria-label="Visualizar" (click)="openAnalysisModal(analise)"><i class="fa-solid fa-eye"></i></button>
                                    <button class="btn-icon btn-icon-danger" aria-label="Excluir" (click)="abrirModalExclusao(analise)"><i class="fa-solid fa-trash"></i></button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    @if (isAnalysisModalOpen && selectedAnalysis) {
        <div class="modal-overlay" (click)="closeAnalysisModal()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2 class="modal-title">Detalhes da Análise</h2>
              <button class="btn-icon" (click)="closeAnalysisModal()"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="modal-body">
              <div class="analysis-details">
                <h3>{{ selectedAnalysis.titulo }}</h3>
                <div class="details-meta">
                  <span><strong>Data:</strong> {{ selectedAnalysis.data }}</span>
                  <span><strong>Status:</strong> <span class="status-badge status-concluida">{{ selectedAnalysis.status }}</span></span>
                </div>
                <p class="details-content">{{ selectedAnalysis.conteudo }}</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeAnalysisModal()">Fechar</button>
            </div>
          </div>
        </div>
    }
    
    @if (isDeleteModalVisible) {
        <div class="modal-overlay-confirm" (click)="fecharModalExclusao()">
            <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
            <div class="modal-body">
                <div class="modal-icon"> <i class="fa-solid fa-triangle-exclamation"></i> </div>
                <div class="modal-text">
                <h2 class="modal-title">Confirmar Exclusão</h2>
                @if (analiseParaExcluir) {
                    <p>Você tem certeza que deseja excluir a análise <strong>{{ analiseParaExcluir.titulo }}</strong>? Esta ação não pode ser desfeita.</p>
                }
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="fecharModalExclusao()">Cancelar</button>
                <button class="btn btn-danger" (click)="confirmarExclusao()">Sim, Excluir</button>
            </div>
            </div>
        </div>
    }
</div>